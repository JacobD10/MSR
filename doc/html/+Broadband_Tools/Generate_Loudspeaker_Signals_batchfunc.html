<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of Generate_Loudspeaker_Signals_batchfunc</title>
  <meta name="keywords" content="Generate_Loudspeaker_Signals_batchfunc">
  <meta name="description" content="">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../index.html">Home</a> &gt;  <a href="index.html">+Broadband_Tools</a> &gt; Generate_Loudspeaker_Signals_batchfunc.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../index.html"><img alt="<" border="0" src="../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for +Broadband_Tools&nbsp;<img alt=">" border="0" src="../right.png"></a></td></tr></table>-->

<h1>Generate_Loudspeaker_Signals_batchfunc
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong></strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>function Generate_Loudspeaker_Signals_batchfunc(SYS_or_Zone_Weights, Noise_Mask_Levels, Signal_Type, Main_Setup, Masker_Setup) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre class="comment"></pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../matlabicon.gif)">
</ul>
This function is called by:
<ul style="list-style-image:url(../matlabicon.gif)">
</ul>
<!-- crossreference -->



<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function Generate_Loudspeaker_Signals_batchfunc(SYS_or_Zone_Weights, Noise_Mask_Levels, Signal_Type, Main_Setup, Masker_Setup)</a>
0002 
0003 SYS_type = <span class="string">'Current_Systems.SR_System'</span>;
0004 
0005 <span class="comment">%% Initialise</span>
0006 tic;
0007 C = clock;
0008 fprintf(<span class="string">'Started execution at %.0f:%.0f:%.0f on the %.0f/%.0f/%.0f\n'</span>,C([4:6 3:-1:1]))
0009 
0010 <span class="keyword">if</span> nargin == 1
0011     <span class="keyword">if</span> isa(SYS_or_Zone_Weights,SYS_type)
0012         SYS = SYS_or_Zone_Weights;        
0013         Zone_Weights = SYS.signal_info.weight;
0014         Noise_Mask_Levels = SYS.signal_info.L_noise_mask;
0015         Signal_Type = SYS.signal_info.method;
0016         Main_Setup = SYS.Main_Setup;
0017         Masker_Setup = SYS.Masker_Setup;
0018         LUT_res = SYS.system_info.LUT_resolution;
0019         Input_file_path = SYS.signal_info.speech_filepath;                
0020     <span class="keyword">else</span>
0021         error([<span class="string">'Single input argument must be of type: '</span> SYS_type]);
0022     <span class="keyword">end</span>
0023 <span class="keyword">elseif</span> nargin == 5
0024     Zone_Weights = SYS_or_Zone_Weights;
0025     <span class="comment">%LUT_res = '512f_256w';</span>
0026     LUT_res = <span class="string">'512f_32w'</span>;
0027     Input_file_path = <span class="string">'+Miscellaneous\+Speech_Files\'</span>;
0028     <span class="comment">%Input_file_path = '+Miscellaneous\+Speech_File_Test\';</span>
0029     <span class="comment">%Input_file_path = '+Miscellaneous\+Noise_Files\';</span>
0030     <span class="comment">%Input_file_path = '+Miscellaneous\+TestAudio_Files\';</span>
0031     <span class="comment">%Input_file_path = '+Miscellaneous\+STIPA_Test\';</span>
0032     <span class="comment">%Input_file_path = '+Miscellaneous\+Impulse_Response\';</span>
0033     <span class="comment">%Input_file_path = '+Miscellaneous\+Sine_Sweep\';</span>
0034     SYS.signal_info.Fs = 16000;
0035 <span class="keyword">end</span>
0036 
0037 
0038 <span class="comment">%% Start</span>
0039 files = Tools.getAllFiles(Input_file_path);
0040 
0041 fprintf(<span class="string">'\n====== Building Broadband Multizone-Soundfield Loudspeaker-Signals ======\n'</span>);
0042 fprintf([<span class="string">'         Zone Weights: '</span> strrep(sprintf(strrep(repmat(<span class="string">'%d'</span>,1,length(Zone_Weights)),<span class="string">'d%'</span>,<span class="string">'d %'</span>),Zone_Weights),<span class="string">' '</span>,<span class="string">' &amp; '</span>) <span class="string">'\n'</span>]);
0043 <span class="keyword">if</span> ~contains(Signal_Type,<span class="string">'NoMask'</span>)
0044 fprintf([<span class="string">'    Noise Mask Levels: '</span> [strrep(sprintf(strrep(repmat(<span class="string">'%d'</span>,1,length(Noise_Mask_Levels)),<span class="string">'d%'</span>,<span class="string">'d %'</span>),Noise_Mask_Levels),<span class="string">' '</span>,<span class="string">'dB &amp; '</span>) <span class="string">'dB'</span>] <span class="string">'\n'</span>]); <span class="keyword">end</span>
0045 fprintf([<span class="string">'          Signal Type: '</span> Signal_Type <span class="string">'\n'</span>]);
0046 fprintf([<span class="string">'         Source Angle: '</span> num2str(Main_Setup.Multizone_Soundfield.Bright_Zone.SourceOrigin.Angle) <span class="string">'\n\n'</span>]);n=0;
0047 fprintf(<span class="string">'\tCompletion: '</span>);
0048 
0049 fileLoopBreak = false; <span class="comment">% Break file loop</span>
0050 weightLoopBreak = false; <span class="comment">% Break weight loop</span>
0051 noiseLoopBreak = false; <span class="comment">% Break noise mask level loop</span>
0052 F=length(files);
0053 maxSigLength = 0; <span class="comment">% Find maximum signal length for the noise maskers</span>
0054 <span class="keyword">if</span> contains(lower(Signal_Type),<span class="string">'masker'</span>)
0055     <span class="keyword">for</span> file = 1:F
0056         <span class="keyword">try</span>
0057             audioSig = audioread(files{file});
0058         <span class="keyword">catch</span> err
0059             <span class="keyword">if</span> strcmp(err.identifier, <span class="string">'MATLAB:audiovideo:audioread:FileTypeNotSupported'</span>)
0060                 <span class="keyword">continue</span>; <span class="comment">% Skip unsupported files</span>
0061             <span class="keyword">end</span>
0062         <span class="keyword">end</span>
0063         ExtraLength_fromFilts = <span class="keyword">...</span>
0064             (max( SYS.system_info.Calibration_FiltLen , SYS.signal_info.rir_duration) + 0.5) <span class="keyword">...</span>
0065         * SYS.signal_info.Fs; <span class="comment">%Extra noise for the filters plus half a second for good measure</span>
0066         maxSigLength = sum([maxSigLength, length(audioSig) + ExtraLength_fromFilts]);
0067     <span class="keyword">end</span>    
0068 <span class="keyword">end</span>
0069 <span class="keyword">if</span> contains(lower(Signal_Type), <span class="string">'cancel'</span>)
0070     k_ = strfind(lower(Signal_Type),<span class="string">'cancel'</span>);
0071     Signal_Type(k_:k_+numel(<span class="string">'cancel'</span>)-1)=[];
0072 <span class="keyword">end</span>
0073 <span class="keyword">for</span> file = 1:F
0074     W = length(Zone_Weights);
0075     <span class="keyword">for</span> w = 1:W
0076         
0077         <span class="keyword">if</span> strcmp(Signal_Type, <span class="string">'NoMask'</span>)
0078                 SYS.signal_info.weight = Zone_Weights(w);
0079                 Broadband_Tools.Loudspeaker_Signal_Calculation.Clean_from_LUT( <span class="keyword">...</span>
0080                     files{file}, <span class="keyword">...</span>
0081                     SYS);
0082         <span class="keyword">end</span>
0083         M = length(Noise_Mask_Levels);
0084         <span class="keyword">for</span> m = 1:M
0085             
0086             <span class="keyword">if</span> strcmp(Signal_Type, <span class="string">'FlatMask'</span>)
0087                 Broadband_Tools.Loudspeaker_Signal_Calculation.Clean_from_LUT_FlatMask( <span class="keyword">...</span>
0088                     files{file}, <span class="keyword">...</span>
0089                     LUT_res, <span class="keyword">...</span>
0090                     Noise_Mask_Levels(m), <span class="keyword">...</span>
0091                     Zone_Weights(w), <span class="keyword">...</span>
0092                     Main_Setup);
0093                 
0094             <span class="keyword">elseif</span> strcmp(Signal_Type, <span class="string">'ZoneWeightMask'</span>) 
0095                 Broadband_Tools.Loudspeaker_Signal_Calculation.Clean_from_LUT_ZoneWeightedMask( <span class="keyword">...</span>
0096                     files{file}, <span class="keyword">...</span>
0097                     LUT_res, <span class="keyword">...</span>
0098                     Noise_Mask_Levels(m), <span class="keyword">...</span>
0099                     Zone_Weights(w), <span class="keyword">...</span>
0100                     Main_Setup); 
0101                 
0102             <span class="keyword">elseif</span> strcmp(Signal_Type, <span class="string">'ZoneWeightMask_AliasCtrl'</span>)
0103                 Broadband_Tools.Loudspeaker_Signal_Calculation.Clean_from_LUT_ZoneWeightedMask_AliasCtrl( <span class="keyword">...</span>
0104                     files{file}, <span class="keyword">...</span>
0105                     LUT_res, <span class="keyword">...</span>
0106                     Noise_Mask_Levels(m), <span class="keyword">...</span>
0107                     Zone_Weights(w), <span class="keyword">...</span>
0108                     Main_Setup, <span class="keyword">...</span>
0109                     Masker_Setup); 
0110                 
0111             <span class="keyword">elseif</span> strcmp(Signal_Type, <span class="string">'ZoneWeightMask_AliasCtrl_OffsetNoise'</span>)
0112                 Broadband_Tools.Loudspeaker_Signal_Calculation.Clean_from_LUT_ZoneWeightedMask_AliasCtrl_OffsetNoise( <span class="keyword">...</span>
0113                     files{file}, <span class="keyword">...</span>
0114                     LUT_res, <span class="keyword">...</span>
0115                     Noise_Mask_Levels(m), <span class="keyword">...</span>
0116                     Zone_Weights(w), <span class="keyword">...</span>
0117                     Main_Setup, <span class="keyword">...</span>
0118                     Masker_Setup);     <span class="comment">%Leakage Angle into Quiet Zone</span>
0119                 
0120             <span class="keyword">elseif</span> strcmp(Signal_Type, <span class="string">'ZoneWeightMask_AliasCtrl_StereoNoise'</span>)
0121                 Broadband_Tools.Loudspeaker_Signal_Calculation.Clean_from_LUT_ZoneWeightedMask_AliasCtrl_StereoNoise( <span class="keyword">...</span>
0122                     files{file}, <span class="keyword">...</span>
0123                     LUT_res, <span class="keyword">...</span>
0124                     Noise_Mask_Levels(m), <span class="keyword">...</span>
0125                     Zone_Weights(w), <span class="keyword">...</span>
0126                     Main_Setup, <span class="keyword">...</span>
0127                     Masker_Setup);     <span class="comment">%Leakage Angle into Quiet Zone</span>
0128                 
0129                 
0130             <span class="comment">%%% Maskers Only</span>
0131             <span class="keyword">elseif</span> strcmp(Signal_Type, <span class="string">'FlatMasker'</span>)
0132                 SYS.signal_info.L_noise_mask = Noise_Mask_Levels(m);
0133                 SYS.signal_info.weight = Zone_Weights(w);
0134                 Broadband_Tools.Loudspeaker_Signal_Calculation.FlatMasker( <span class="keyword">...</span>
0135                     maxSigLength, <span class="keyword">...</span><span class="comment"> </span>
0136                     SYS);
0137                 fileLoopBreak = true; file=F; <span class="comment">% Break file loop</span>
0138                 
0139             <span class="keyword">elseif</span> strcmp(Signal_Type, <span class="string">'ZoneWeightMasker'</span>)
0140                 SYS.signal_info.L_noise_mask = Noise_Mask_Levels(m);
0141                 SYS.signal_info.weight = Zone_Weights(w);
0142                 Broadband_Tools.Loudspeaker_Signal_Calculation.ZoneWeightedMasker( <span class="keyword">...</span>
0143                     maxSigLength, <span class="keyword">...</span><span class="comment"> </span>
0144                     SYS);
0145                 fileLoopBreak = true; file=F; <span class="comment">% Break file loop</span>
0146                 
0147             <span class="keyword">elseif</span> contains(Signal_Type, <span class="string">'ZoneWeightMaskerAliasCtrl'</span>)
0148                 SYS.signal_info.L_noise_mask = Noise_Mask_Levels(m);
0149                 SYS.signal_info.weight = Zone_Weights(w);
0150                 Broadband_Tools.Loudspeaker_Signal_Calculation.ZoneWeightedMasker_AliasCtrl( <span class="keyword">...</span>
0151                     maxSigLength, <span class="keyword">...</span><span class="comment"> </span>
0152                     SYS);
0153                 fileLoopBreak = true; file=F; <span class="comment">% Break file loop</span>
0154                 
0155                 
0156             <span class="keyword">elseif</span> strcmp(Signal_Type, <span class="string">'ParametricMasker'</span>)
0157                 Broadband_Tools.Loudspeaker_Signal_Calculation.ParametricMask( <span class="keyword">...</span>
0158                     maxSigLength, <span class="keyword">...</span><span class="comment"> </span>
0159                     LUT_res, <span class="keyword">...</span>
0160                     Noise_Mask_Levels(m), <span class="keyword">...</span>
0161                     Masker_Setup, <span class="keyword">...</span>
0162                     Main_Setup);                     
0163                 fileLoopBreak = true; file=F; <span class="comment">% Break file loop</span>
0164                 weightLoopBreak = true; w=W; <span class="comment">% Break weight loop</span>
0165                 
0166                 
0167             <span class="keyword">elseif</span> strcmp(Signal_Type, <span class="string">'ParametricMaskerAliasCtrlHPF'</span>)
0168                 Broadband_Tools.Loudspeaker_Signal_Calculation.ParametricMask_AliasCtrlHPF( <span class="keyword">...</span>
0169                     maxSigLength, <span class="keyword">...</span><span class="comment"> </span>
0170                     LUT_res, <span class="keyword">...</span>
0171                     Noise_Mask_Levels(m), <span class="keyword">...</span>
0172                     Masker_Setup, <span class="keyword">...</span>
0173                     Main_Setup);                     
0174                 fileLoopBreak = true; file=F; <span class="comment">% Break file loop</span>
0175                 weightLoopBreak = true; w=W; <span class="comment">% Break weight loop</span>
0176                 
0177             <span class="keyword">end</span>
0178             
0179             n = Tools.showTimeToCompletion( ((file-1)*W*M + (w-1)*M + m) / (F*W*M), n);
0180             
0181             <span class="keyword">if</span> noiseLoopBreak
0182                 <span class="keyword">break</span>
0183             <span class="keyword">end</span>
0184         <span class="keyword">end</span>
0185        
0186         <span class="keyword">if</span> weightLoopBreak
0187             <span class="keyword">break</span>
0188         <span class="keyword">end</span>
0189     <span class="keyword">end</span>
0190     
0191     <span class="keyword">if</span> fileLoopBreak
0192         <span class="keyword">break</span>
0193     <span class="keyword">end</span>
0194 <span class="keyword">end</span>
0195 
0196 
0197 <span class="comment">%%</span>
0198 tEnd = toc;
0199 fprintf(<span class="string">'\nExecution time: %dmin(s) %fsec(s)\n\n'</span>, floor(tEnd/60), rem(tEnd,60)); <span class="comment">%Time taken to execute this script</span>
0200 
0201 <span class="comment">% Restart dropbox</span>
0202 <span class="comment">%Tools.Dropbox('start');</span></pre></div>
<hr><address>Generated on Sun 09-Jul-2017 20:35:18 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>