<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of RIR_from_loudspeaker_setup_rir_generator</title>
  <meta name="keywords" content="RIR_from_loudspeaker_setup_rir_generator">
  <meta name="description" content="RIR_FROM_LOUDSPEAKER_SETUP Returns the RIR for each sample point in each">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../index.html">Home</a> &gt;  <a href="../index.html">+Room_Acoustics</a> &gt; <a href="index.html">+RIR_Generation</a> &gt; RIR_from_loudspeaker_setup_rir_generator.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../index.html"><img alt="<" border="0" src="../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for +Room_Acoustics\+RIR_Generation&nbsp;<img alt=">" border="0" src="../../right.png"></a></td></tr></table>-->

<h1>RIR_from_loudspeaker_setup_rir_generator
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>RIR_FROM_LOUDSPEAKER_SETUP Returns the RIR for each sample point in each</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>function [ RIR_Bright, RIR_Quiet, Rec_Bright_Pos, Rec_Quiet_Pos, rec_b, rec_q ] = RIR_from_loudspeaker_setup_rir_generator( loudspeaker_setup, room, reverb_time, signal_info, rec_positions ) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre class="comment">RIR_FROM_LOUDSPEAKER_SETUP Returns the RIR for each sample point in each
zone for a given multizone loudspeaker setup using rir_generator
   Returns a matrix which contains the RIR (column values) for each
   sample point (rows).


   Author: Jacob Donley, University of Wollongong, Australia
   Email: Jacob.Donley089@uowmail.edu.au</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../matlabicon.gif)">
</ul>
This function is called by:
<ul style="list-style-image:url(../../matlabicon.gif)">
</ul>
<!-- crossreference -->



<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function [ RIR_Bright, RIR_Quiet, Rec_Bright_Pos, Rec_Quiet_Pos, rec_b, rec_q ] = RIR_from_loudspeaker_setup_rir_generator( loudspeaker_setup, room, reverb_time, signal_info, rec_positions )</a>
0002 <span class="comment">%RIR_FROM_LOUDSPEAKER_SETUP Returns the RIR for each sample point in each</span>
0003 <span class="comment">%zone for a given multizone loudspeaker setup using rir_generator</span>
0004 <span class="comment">%   Returns a matrix which contains the RIR (column values) for each</span>
0005 <span class="comment">%   sample point (rows).</span>
0006 <span class="comment">%</span>
0007 <span class="comment">%</span>
0008 <span class="comment">%   Author: Jacob Donley, University of Wollongong, Australia</span>
0009 <span class="comment">%   Email: Jacob.Donley089@uowmail.edu.au</span>
0010 <span class="comment">%</span>
0011 tic;
0012 
0013 <span class="comment">%Set up room dimensions and characteristics</span>
0014 <span class="keyword">if</span> nargin &lt; 2
0015     room.Room_Size = [5, 4, 3];
0016     room.Reproduction_Centre = room.Room_Size./2;
0017 <span class="keyword">end</span>
0018 <span class="keyword">if</span> nargin &lt; 3
0019     beta = 0.4; <span class="comment">% Reverberation time (s)</span>
0020 <span class="keyword">else</span>
0021     beta = reverb_time;
0022 <span class="keyword">end</span>
0023 <span class="keyword">if</span> nargin &lt; 4
0024     n = 4096;   <span class="comment">% Number of samples</span>
0025 <span class="keyword">else</span>
0026     n = signal_info.rir_duration * signal_info.Fs;
0027 <span class="keyword">end</span>
0028 <span class="keyword">if</span> nargin &lt; 5
0029     rec_positions = [];
0030 <span class="keyword">end</span>
0031 
0032 dim = room.Room_Dimensions;
0033 mtype = <span class="string">'omnidirectional'</span>;  <span class="comment">% Type of microphone</span>
0034 order = -1;                 <span class="comment">% -1 equals maximum reflection order!</span>
0035 orientation = 0;            <span class="comment">% Microphone orientation (rad)</span>
0036 hp_filter = 0;              <span class="comment">% Enable high-pass filter</span>
0037 
0038 c = signal_info.c;    <span class="comment">% Speed of sound (m/s)</span>
0039 Fs = signal_info.Fs; <span class="comment">% Sample frequency (samples/s)</span>
0040 
0041 <span class="comment">%Add all sources (loudspeaker locations)</span>
0042 src = [];
0043 [src(:,1), src(:,2)] = pol2cart( loudspeaker_setup.Loudspeaker_Locations(:,1), loudspeaker_setup.Loudspeaker_Locations(:,2));
0044 src = [src zeros(size(src,1),size(room.Room_Size,2)-2)] + repmat(room.Reproduction_Centre, size(src,1),1);
0045 
0046 
0047 <span class="comment">%Add all receviers (multizone sample point locations)</span>
0048 <span class="keyword">if</span> isempty(rec_positions)
0049     
0050     mask_b = loudspeaker_setup.Multizone_Soundfield.Bright_Zone.Soundfield_d_mask;
0051     mask_q = loudspeaker_setup.Multizone_Soundfield.Quiet_Zone.Soundfield_d_mask;
0052     
0053     rec_b = [];
0054     angl = loudspeaker_setup.Bright_Samples_Locations(:,:,1);
0055     dis = loudspeaker_setup.Bright_Samples_Locations(:,:,2);
0056     [rec_b(:,1), rec_b(:,2)] = pol2cart( angl(:), dis(:));
0057     rec_b = [rec_b zeros(size(rec_b,1),size(room.Room_Size,2)-2)] + repmat(room.Reproduction_Centre, size(rec_b,1),1);
0058     rec_b = rec_b(mask_b(:) ~= 0,:);
0059     
0060     rec_q = [];
0061     angl = loudspeaker_setup.Quiet_Samples_Locations(:,:,1);
0062     dis = loudspeaker_setup.Quiet_Samples_Locations(:,:,2);
0063     [rec_q(:,1), rec_q(:,2)] = pol2cart( angl(:), dis(:));
0064     rec_q = [rec_q zeros(size(rec_q,1),size(room.Room_Size,2)-2)] + repmat(room.Reproduction_Centre, size(rec_q,1),1);
0065     rec_q = rec_q(mask_q(:) ~= 0,:);
0066     
0067     
0068     Rec_Bright_Pos = rec_b;
0069     Rec_Quiet_Pos = rec_q;
0070     <span class="comment">% Generate random number seed from current time</span>
0071     rng(<span class="string">'shuffle'</span>);
0072     <span class="comment">%Use random samples</span>
0073     <span class="keyword">if</span> room.NoReceivers ~= -1
0074         ind_rec_b_rnd = randi(size(Rec_Bright_Pos,1),1,room.NoReceivers);
0075         Rec_Bright_Pos = Rec_Bright_Pos(ind_rec_b_rnd,:);
0076         
0077         ind_rec_q_rnd = randi(size(Rec_Quiet_Pos,1),1,room.NoReceivers);
0078         Rec_Quiet_Pos = Rec_Quiet_Pos(ind_rec_q_rnd,:);
0079     <span class="keyword">end</span>
0080     
0081 <span class="keyword">else</span>
0082     
0083     Rec_Bright_Pos = rec_positions.Bright_Receiver_Positions;
0084     Rec_Quiet_Pos = rec_positions.Quiet_Receiver_Positions;
0085     
0086 <span class="keyword">end</span>
0087 
0088 <span class="comment">%%</span>
0089 <span class="comment">%Evalute the Room Impulse Responses</span>
0090 RIR_Bright = zeros([size(Rec_Bright_Pos,1), n, size(src,1)]);
0091 RIR_Quiet  = zeros([size(Rec_Quiet_Pos,1), n, size(src,1)]);
0092 
0093 room_size = room.Room_Size;
0094 current_pool = parpool; <span class="comment">%Start new pool</span>
0095 fprintf(<span class="string">'\n====== Building RIR Database ======\n'</span>);
0096 parfor_progress( size(src,1) );
0097 parfor s = 1:size(src,1)
0098     RIR_Bright(:,:,s) = rir_generator( <span class="keyword">...</span>
0099         c, Fs, <span class="keyword">...</span>
0100         Rec_Bright_Pos, <span class="keyword">...</span>
0101         src(s,:), <span class="keyword">...</span>
0102         room_size, <span class="keyword">...</span>
0103         beta, n , mtype, order, dim, orientation, hp_filter);
0104     
0105     RIR_Quiet(:,:,s) = rir_generator( <span class="keyword">...</span>
0106         c, Fs, <span class="keyword">...</span>
0107         Rec_Quiet_Pos, <span class="keyword">...</span>
0108         src(s,:), <span class="keyword">...</span>
0109         room_size, <span class="keyword">...</span>
0110         beta, n , mtype, order, dim, orientation, hp_filter);
0111         
0112     parfor_progress;
0113 <span class="keyword">end</span>
0114 parfor_progress(0);
0115 
0116 <span class="comment">%%</span>
0117 tEnd = toc;
0118 fprintf(<span class="string">'\nRIR execution time: %dmin(s) %fsec(s)\n\n'</span>, floor(tEnd/60), rem(tEnd,60)); <span class="comment">%Time taken to execute this script</span>
0119 
0120 
0121 <span class="keyword">end</span>
0122</pre></div>
<hr><address>Generated on Sun 09-Jul-2017 20:35:18 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>