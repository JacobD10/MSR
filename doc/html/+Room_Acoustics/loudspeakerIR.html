<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of loudspeakerIR</title>
  <meta name="keywords" content="loudspeakerIR">
  <meta name="description" content="LOUDSPEAKERIR Computes impulse response from loudspeaker directivity">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../index.html">Home</a> &gt;  <a href="index.html">+Room_Acoustics</a> &gt; loudspeakerIR.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../index.html"><img alt="<" border="0" src="../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for +Room_Acoustics&nbsp;<img alt=">" border="0" src="../right.png"></a></td></tr></table>-->

<h1>loudspeakerIR
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>LOUDSPEAKERIR Computes impulse response from loudspeaker directivity</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>function [ ImpRsp, DirLst ] = loudspeakerIR( loudspeaker_setup, room, n_positions, n_samples, Fs, rec_positions, norm_positions ) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre class="comment">LOUDSPEAKERIR Computes impulse response from loudspeaker directivity
according to the corresponding loudspeaker object.

   This allows a single impulse response to be calculated so that
   MCRoomSim can use the frequency dependent directivity along with the
   image method to compute the room response of a directional source.</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../matlabicon.gif)">
</ul>
This function is called by:
<ul style="list-style-image:url(../matlabicon.gif)">
</ul>
<!-- crossreference -->



<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function [ ImpRsp, DirLst ] = loudspeakerIR( loudspeaker_setup, room, n_positions, n_samples, Fs, rec_positions, norm_positions )</a>
0002 <span class="comment">%LOUDSPEAKERIR Computes impulse response from loudspeaker directivity</span>
0003 <span class="comment">%according to the corresponding loudspeaker object.</span>
0004 <span class="comment">%</span>
0005 <span class="comment">%   This allows a single impulse response to be calculated so that</span>
0006 <span class="comment">%   MCRoomSim can use the frequency dependent directivity along with the</span>
0007 <span class="comment">%   image method to compute the room response of a directional source.</span>
0008 S = loudspeaker_setup;
0009 <span class="keyword">if</span> S.Loudspeaker_Count ~= 1
0010     error(<span class="string">'Can only compute Impulse Response for a single loudspeaker in the given loudspeaker setup.'</span>)
0011 <span class="keyword">end</span>
0012 
0013 freqs = linspace(0, Fs/2, n_samples+1);
0014 freqs(end)=[];
0015 
0016 xx = [];
0017 yy = [];
0018 
0019 <span class="keyword">if</span> nargin &gt;= 6 &amp;&amp; ~isempty(norm_positions)
0020     xx = [norm_positions(:,1)] <span class="keyword">...</span>
0021           - room.Reproduction_Centre(1);
0022     yy = [norm_positions(:,2)] <span class="keyword">...</span>
0023           - room.Reproduction_Centre(2);
0024 <span class="keyword">end</span>
0025 
0026 <span class="keyword">if</span> nargin &gt;= 5 &amp;&amp; ~isempty(rec_positions)
0027     xx = [xx; <span class="keyword">...</span>
0028         [rec_positions.Bright_Receiver_Positions(:,1); <span class="keyword">...</span>
0029         rec_positions.Quiet_Receiver_Positions(:,1)] <span class="keyword">...</span>
0030         - room.Reproduction_Centre(1)];
0031     yy = [yy; <span class="keyword">...</span>
0032         [rec_positions.Bright_Receiver_Positions(:,2); <span class="keyword">...</span>
0033         rec_positions.Quiet_Receiver_Positions(:,2)] <span class="keyword">...</span>
0034         - room.Reproduction_Centre(2)];
0035 <span class="keyword">end</span>
0036 
0037 <span class="comment">% Some impule response relative positions</span>
0038 r = ones(1,n_positions);
0039 th = linspace(-pi,pi, n_positions +1); th(end)=[];
0040 [x,y] = pol2cart( th(:), r(:));
0041 
0042 [spkrX, spkrY] = pol2cart( <span class="keyword">...</span>
0043     S.Loudspeaker_Locations(:,1), <span class="keyword">...</span>
0044     S.Loudspeaker_Locations(:,2));
0045 
0046 xx = [xx, x + spkrX];
0047 yy = [yy, y + spkrY];
0048 zz = zeros(size(xx));
0049 
0050 [~,H] = S.computeField( xx, yy, freqs );
0051 
0052 
0053 <span class="comment">% Normalise bright zone response if given some bright zone positions</span>
0054 <span class="keyword">if</span> nargin &gt;= 6 &amp;&amp; ~isempty(norm_positions)
0055     H_EQ = mean( abs(H(1:size(norm_positions,1),:)) , 1); <span class="comment">%Find normalise value from the positions given</span>
0056     H = H(size(norm_positions,1)+1:<span class="keyword">end</span>,:);  <span class="comment">%Remove normalisation positions</span>
0057     H(:,2:end) = H(:,2:end) ./ repmat(H_EQ(2:end),size(H,1),1); <span class="comment">%Normalise</span>
0058     H = H ./ (max(abs(H(:))) * loudspeaker_setup.Loudspeaker_Object.P1);
0059 <span class="keyword">end</span>
0060 
0061 <span class="comment">%Do IR stuff here</span>
0062 Z = cat(2, H, conj(flip(H,2)) );
0063 [az, el, rr] = cart2sph( xx - spkrX, yy - spkrY, zz );
0064 ir = real( ifft( Z, [], 2 ));
0065 ir(isnan(ir))=0;
0066 ir = flip( circshift(ir, size(ir,2)/2, 2 ), 2 );
0067 
0068 ImpRsp = ir(:,end/2+1:end);
0069 DirLst = [az(:)/pi*180, el(:)/pi*180, rr(:)];
0070 <span class="keyword">end</span>
0071</pre></div>
<hr><address>Generated on Sun 09-Jul-2017 20:35:18 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>